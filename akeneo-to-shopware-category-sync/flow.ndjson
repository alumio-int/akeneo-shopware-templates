{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"akeneo-fetch-categories","name":"Akeneo - Fetch - Categories","object":{"parameters":{"job":[{"prototype":"run-incoming","parameters":{"incoming":"akeneo-fetch-categories"}}],"handlers":[],"priority":2,"expression":"*/15 * * * *"}},"description":"","owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"incoming-configuration","identifier":"akeneo-fetch-categories","name":"Akeneo - Fetch - Categories","object":{"parameters":{"subscriber":{"prototype":"http-subscriber","parameters":{"client":"akeneo-http-client","request":{"uri":"/api/rest/v1/categories","payload":"&{payload}","plugins":[],"payloadType":"data","authentications":[]},"pagination":{"prototype":"next","parameters":{"pattern":"_links.next","pageLimit":10000}},"transformer":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"test","value":"${AKENEO_ROOT_CATEGORY}","mappers":[]}]}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"test"}},"conditions":[{"prototype":"not-empty","parameters":[]},{"prototype":"not-equals","parameters":{"value":null}}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"payload","value":{"limit":100,"search":"{\"parent\":[{\"operator\":\"=\",\"value\":\"&{test}\"}]}","with_position":true,"with_enriched_attributes":true},"mappers":[]}]}}],"elseTransformers":[{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"payload","value":{"limit":100,"with_position":true,"with_enriched_attributes":true},"mappers":[]}]}}]}}]}},"deserializer":{"prototype":"json","parameters":{"pattern":"_embedded.items","readMethod":"wholeFile","encodeInput":false}},"requestListeners":[]}},"transformers":["akeneo-prepare-convert-labels-to-localizations","akeneo-convert-category-to-alumio-base","akeneo-filter-previous-category"]}},"description":"We need to get all categories from Akeneo system to ensure the parent children relation can be sent in the right order. To do so, we use an Incoming **\"Akeneo - Fetch - Categories\"** to get data from Akeneo Server.\n\nThis incoming will create a task inside Alumio with data structured as Alumio base categories.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"akeneo-http-client","name":"Akeneo - HTTP Client","object":{"prototype":"akeneo-http-client-v2","parameters":{"key":"","baseUri":"${AKENEO_BASE_URL}","advanced":[],"clientId":"${AKENEO_CLIENT_ID}","password":"${AKENEO_PASSWORD}","username":"${AKENEO_USERNAME}","clientSecret":"${AKENEO_CLIENT_SECRET}","enableLogging":true,"loggerFormatter":"full"}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-prepare-convert-labels-to-localizations","name":"Akeneo - Prepare convert - Labels - To localizations","object":{"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"accessor-move","parameters":{"source":{"prototype":"key","parameters":{"keys":[],"root":"labels"}},"destination":{"prototype":"structure","parameters":{"key":"localeCode","keys":[],"root":"localizations","value":"translation"}},"stripEnclosures":true}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"labels"}]}}]}},"description":"Change labels from Akeneo into Alumio Base localizations","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-convert-category-to-alumio-base","name":"Akeneo - Convert - Category - To Alumio Base","object":{"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"_links"},{"key":"updated"}]}}]}}]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-filter-previous-category","name":"Akeneo - Filter previous - Category","object":{"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"type-setter","parameters":{"entityType":"base-category"}},{"meta":[],"prototype":"storage-filter-stored-entity","parameters":{"storage":"akeneo-filter-previous-categories","addEntityToStorage":true}}]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"entity","identifier":"base-category","name":"Base - Category","object":{"parameters":{"schema":[],"identifierPath":["code"]}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"akeneo-filter-previous-categories","name":"Akeneo - Filter previous - Categories","object":{"parameters":{"path":"akeneo-filter-previous-categories-01K9SMTHBERR3NS49Z7M1QQF46","logger":{"parameters":{"actions":[]}}}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"shopware-send-categories","name":"Shopware - Send - Categories","object":{"parameters":{"job":[{"prototype":"run-outgoing","parameters":{"route":"synchronize-categories-from-akeneo-into-shopware","numTasks":1000,"enableUnlimitedTasks":false}}],"handlers":[],"priority":2,"expression":"*/15 * * * *"}},"description":"","owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"route-configuration","identifier":"synchronize-categories-from-akeneo-into-shopware","name":"Synchronize Categories - from Akeneo into Shopware","object":{"parameters":{"incoming":"akeneo-fetch-categories","outgoing":"shopware-send-category","realtime":false,"transformers":[],"retryStatuses":[],"waitingStatus":false,"parallelExecution":{"maximumProcesses":1}}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"outgoing-configuration","identifier":"shopware-send-category","name":"Shopware - Send - Category","object":{"parameters":{"publisher":{"prototype":"no-action-publisher","parameters":[]},"transformers":["shopware-prepare-convert-category-translations-from-alumio-base-category","shopware-prepare-convert-category-parent-from-alumio-base-category","shopware-convert-category-from-alumio-base-category","shopware-check-and-send-category"]}},"description":"The data flow between systems is as follows:\n\n- A category created or updated inside the Akeneo system. (Settings -> Categories)\n- Alumio catches the change from the Incoming \"Akeneo - Fetch - Categories\" and creates a task.\n- Alumio processed the task data to be suited to Shopware using the Outgoing \"Showpare - Send - Category\".\n- The data is further sent into Shopware as category. (Categories -> Category list)\n\n","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"shopware-prepare-convert-category-translations-from-alumio-base-category","name":"Shopware - Prepare convert - Translations from Alumio Base","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"node","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"localizations.*"}},"nodeFilters":[],"nodeTransformers":[{"meta":[],"prototype":"storage-get-entity-from-storage","parameters":{"storage":"shopware-locale-code-to-id","storageKey":"&{localeCode}","destination":"localeId"}}]}},{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"pattern-copy","parameters":{"pattern":"localizations","conditions":[],"replacement":"translations"}}]}},{"meta":[],"prototype":"node","parameters":{"accessor":{"prototype":"key","parameters":{"keys":[],"root":"translations"}},"nodeFilters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"localeId"}},"conditions":[{"prototype":"not-empty","parameters":[]}]}}],"nodeTransformers":[]}},{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"accessor-move","parameters":{"source":{"prototype":"structure","parameters":{"key":"localeId","keys":[],"root":"translations","value":"translation"}},"destination":{"prototype":"key","parameters":{"keys":[],"root":"translations"}},"stripEnclosures":true}},{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"translations.*","conditions":[],"replacement":"translations.$1.name"}}]}},{"meta":[],"prototype":"node","parameters":{"accessor":{"prototype":"key","parameters":{"keys":[],"root":"translations"}},"nodeFilters":[],"nodeTransformers":[{"meta":[],"prototype":"pattern-copy","parameters":{"pattern":"name","conditions":[],"replacement":"metaTitle"}},{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"shopId","value":"${SHOPWARE6_SHOP_ID}","mappers":[]}]}}]}}]}},"description":"This transformer will create Shopware translations from Alumio localization.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"shopware-locale-code-to-id","name":"Shopware - Locale - Code to id","object":{"parameters":{"path":"shopware-locale-code-to-id-01KABB0XTCX5Y5WMBG764AACZT","logger":{"parameters":{"actions":[]}}}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"shopware-prepare-convert-category-parent-from-alumio-base-category","name":"Shopware - Prepare convert - Category - Parent from Alumio Base Category","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-exists-condition","parameters":{"path":"parent"}}}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"parent"}},"conditions":[{"prototype":"not-equals","parameters":{"value":null}},{"prototype":"not-equals","parameters":{"value":[]}},{"prototype":"not-equals","parameters":{"value":"${AKENEO_ROOT_CATEGORY}"}}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"storage-get-entity-from-storage","parameters":{"storage":"shopware-category-code-to-id","storageKey":"&{parent}","destination":"parentId"}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"parent"}]}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"key-condition","parameters":{"filter":{"prototype":"key-not-exists-condition","parameters":{"path":"parentId"}}}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"exception","parameters":{"message":"Category id not found for parent"}}],"elseTransformers":[]}}],"elseTransformers":[]}}],"elseTransformers":[{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"parent"}]}}]}}]}},"description":"This transformer will check the parent and map it into Shopware id.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"shopware-category-code-to-id","name":"Shopware - Category - Code to id","object":{"parameters":{"path":"shopware-category-code-to-id-01KA907G8WDHH4QK1NZHF3ABCC","logger":{"parameters":{"actions":[]}}}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"shopware-convert-category-from-alumio-base-category","name":"Shopware - Convert - Category from Alumio Base Category","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"category","value":{"name":"&{(localizations[?localeCode=='en_US'].translation | [0]) || (localizations[?localeCode=='en_GB'].translation | [0]) || (localizations[].translation | [0])}","active":true,"visible":true,"external":"&{code}","metaTitle":"&{(localizations[?localeCode=='en_US'].translation | [0]) || (localizations[?localeCode=='en_GB'].translation | [0]) || (localizations[].translation | [0])}"},"mappers":[]}]}},{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"translations","conditions":[],"replacement":"category.translations"}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"parentId"}},"conditions":[{"prototype":"not-empty","parameters":[]}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"pattern-copy","parameters":{"pattern":"parentId","conditions":[],"replacement":"category.parentId"}}],"elseTransformers":[]}}]}}]}},"description":"This transformer will finally convert Category from Alumio Base into Shopware.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"shopware-check-and-send-category","name":"Shopware - Check and send -  Category","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"id","value":null,"mappers":[]}]}},{"meta":[],"prototype":"storage-get-entity-from-storage","parameters":{"storage":"shopware-category-code-to-id","storageKey":"&{code}","destination":"id"}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"id"}},"conditions":[{"prototype":"equals","parameters":{"value":null}}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"merger","parameters":{"template":{"result":"&{@}"},"transformer":{"meta":[],"prototype":"http-transformer","parameters":{"client":"shopware6-http-client","request":{"uri":"/api/category?_response=detail","method":"POST","payload":"&{category}","plugins":[],"payloadType":"data","authentications":[]}}}}},{"meta":[],"prototype":"storage-save-entity-in-storage","parameters":{"source":"result.data.id","storage":"shopware-category-code-to-id","storageKey":"&{code}"}}],"elseTransformers":[{"meta":[],"prototype":"http-transformer","parameters":{"client":"shopware6-http-client","request":{"uri":"/api/category/&{id}","method":"PATCH","payload":"&{category}","plugins":[],"payloadType":"data","authentications":[]},"deserializer":{"prototype":"plain-text","parameters":{"property":"test","encodeInput":false}}}}]}}]}},"description":"This transformer will check current Shopware category id from previous iteration of this transformer to determine either we need to create or update the category in the Shopware System.","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"shopware6-http-client","name":"Shopware6 - HTTP Client","object":{"prototype":"shopware6-v2-http-client","parameters":{"key":"","baseUrl":"${SHOPWARE6_BASE_URL}","advanced":{"client":"default"},"clientId":"${SHOPWARE6_CLIENT_ID}","clientSecret":"${SHOPWARE6_CLIENT_SECRET}","enableLogging":true,"authenticationType":"client_credentials"}},"description":"","owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"default","name":"Default client","object":{"parameters":{"plugins":[{"prototype":"logger","parameters":{"formatter":"long"}}]}}}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client-test","identifier":"shopware6-http-client--http-client-test","name":"shopware6-http-client http-client Test","object":{"parameters":{"uri":"/api/product","method":"GET"}},"description":null,"owner":"shopware6-http-client","disabled":false}